import{a as W}from"./chunk-Z7JX7RS7.js";import{a as Q}from"./chunk-3E2XEZQ5.js";import{a as oe}from"./chunk-KACECMBE.js";import{a as j,b as v,c as V,d as A,f as k,g as q,h as B,i as G,j as z,k as L,l as $,m as X,n as H,o as J,q as K}from"./chunk-WMSCIBPS.js";import{a as Y}from"./chunk-VR3MZZWK.js";import{a as T}from"./chunk-ZH3L7T54.js";import{i as D,k as R,o as F}from"./chunk-MLHW3EEE.js";import{$ as x,Ba as s,Ca as p,Oa as u,Ra as a,S as h,Ta as o,Ua as r,Ub as O,Va as m,Vb as M,Wa as w,Xa as g,Ya as f,Zb as y,aa as b,db as c,e as ie,eb as N,ha as I,ia as E,lb as U,ya as C}from"./chunk-5XN3BUNB.js";var P=ie(oe());function re(i,t){if(i&1&&(o(0,"option",23),c(1),r()),i&2){let e=t.$implicit;a("value",e._id),s(),N(e.name)}}function ne(i,t){if(i&1&&(o(0,"div",27),m(1,"img",28),r()),i&2){let e=t.$implicit;s(),a("src",e,C)}}function ae(i,t){if(i&1&&(o(0,"div",24)(1,"div",25),u(2,ne,2,1,"div",26),r()()),i&2){let e=f();s(2),a("ngForOf",e.oldImages)}}function se(i,t){if(i&1){let e=w();o(0,"div",30)(1,"div",31),m(2,"img",32),o(3,"button",33),g("click",function(){let l=I(e).index,d=f(2);return E(d.removeImage(l))}),c(4,"X"),r()()()}if(i&2){let e=t.$implicit;s(2),a("src",e,C)}}function ce(i,t){if(i&1&&(o(0,"div",24)(1,"div",25),u(2,se,5,1,"div",29),r()()),i&2){let e=f();s(2),a("ngForOf",e.imagePreviews)}}function de(i,t){if(i&1&&(o(0,"button",34),c(1," Update Product "),r()),i&2){let e=f();a("disabled",e.myForm.invalid)}}function le(i,t){i&1&&(o(0,"div",35)(1,"div",36)(2,"span",37),c(3,"Loading..."),r()()())}var _=class i{constructor(t,e,n,l,d){this.categoryService=t;this.formBuilder=e;this.productService=n;this.router=l;this.route=d;this.myForm=this.formBuilder.group({name:["",[v.required]],price:["",[v.required,v.min(1)]],description:[""],category:["",v.required],images:[""]})}myForm;categories=[];categorySubscription;productSubscription;productId;imagePreviews=[];selectedFiles=[];oldImages=[];fileInput;loading=!1;ngOnInit(){this.getCategories(),this.productId=this.route.snapshot.paramMap.get("id"),this.loadProductDetails(this.productId)}ngOnDestroy(){this.categorySubscription&&this.categorySubscription.unsubscribe(),this.productSubscription&&this.productSubscription.unsubscribe()}getCategories(){this.categorySubscription=this.categoryService.getCategories().subscribe({next:t=>{this.categories=t,this.categories.length>0&&(console.log(this.categories[0]._id),this.myForm.controls.category.setValue(this.categories[0]._id))},error:t=>{console.error("Error fetching categories",t)}})}loadProductDetails(t){this.productSubscription=this.productService.getProductById(t).subscribe({next:e=>{this.myForm.patchValue({name:e.name,price:e.price,description:e.description,category:e.category._id}),this.oldImages=e.images||[]},error:e=>{console.error("Error loading product details",e)}})}onImageSelected(t){this.fileInput=t.target;let e=t.target.files;this.oldImages=[],this.imagePreviews=[],this.selectedFiles=[];for(let n=0;n<e.length&&n<10;n++){let l=e[n];this.selectedFiles.push(l);let d=new FileReader;d.onload=te=>{this.imagePreviews.push(te.target.result)},d.readAsDataURL(l)}}removeImage(t){this.imagePreviews.splice(t,1),this.selectedFiles.splice(t,1);let e=new DataTransfer;this.selectedFiles.forEach(n=>e.items.add(n)),this.fileInput.files=e.files}onCategoryChanged(t){this.myForm.controls.category.setValue(t.target.value)}onSubmit(){this.myForm.valid?(this.loading=!0,this.updateProduct()):console.log("Form is not valid")}updateProduct(){let t=new FormData;t.append("name",this.myForm.value.name),t.append("price",this.myForm.value.price),t.append("description",this.myForm.value.description),t.append("category",this.myForm.value.category),this.selectedFiles.forEach(e=>{t.append("images",e)}),this.productSubscription=this.productService.updateProduct(this.productId,t).subscribe({next:e=>{this.loading=!1,P.default.fire({icon:"success",title:"Product updated successfully",timer:1500}).then(()=>{this.router.navigate(["/listProducts"])})},error:e=>{this.loading=!1,P.default.fire({icon:"error",title:"Error",text:e.error.message,timer:1500})}})}static \u0275fac=function(e){return new(e||i)(p(Q),p(J),p(W),p(R),p(D))};static \u0275cmp=x({type:i,selectors:[["app-update-products"]],standalone:!0,features:[U],decls:42,vars:6,consts:[[1,"container-fluid","p-0"],[1,"row","no-gutters"],[1,"col-12"],[1,"col-2"],[1,"col-10",2,"margin-top","70px"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","name",1,"form-label"],[1,"col-md-6"],["id","name","type","text","formControlName","name","placeholder","Enter product name","required","",1,"form-control"],["for","price",1,"form-label"],["id","price","type","number","formControlName","price","placeholder","Enter price","min","1","required","",1,"form-control"],["for","description",1,"form-label"],["id","description","rows","3","formControlName","description","placeholder","Enter product description",1,"form-control"],["for","category",1,"form-label"],["id","category","formControlName","category",1,"form-control",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","images",1,"form-label"],["id","images","type","file","accept","image/*","multiple","",1,"form-control",3,"change"],["class","form-group mt-3",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center","mt-3"],["type","submit","class","btn btn-success","style","background-color: #4CAF50; border: none;",3,"disabled",4,"ngIf"],["class","d-flex justify-content-center align-items-center mb-3","style","height: 40px;",4,"ngIf"],[3,"value"],[1,"form-group","mt-3"],[1,"row"],["class","col-md-3",4,"ngFor","ngForOf"],[1,"col-md-3"],["alt","Old image preview",1,"img-thumbnail",2,"width","100px","height","auto",3,"src"],["class","col-md-2",4,"ngFor","ngForOf"],[1,"col-md-2"],[1,"position-relative"],["alt","Selected image preview",1,"img-thumbnail",3,"src"],["type","button",1,"btn","btn-remove","position-absolute","top-0","start-100","translate-middle",3,"click"],["type","submit",1,"btn","btn-success",2,"background-color","#4CAF50","border","none",3,"disabled"],[1,"d-flex","justify-content-center","align-items-center","mb-3",2,"height","40px"],["role","status",1,"spinner-border","text-success"],[1,"visually-hidden"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3,"app-navbar"),r()(),o(4,"div",1)(5,"div",3),m(6,"app-admin-sidebar"),r(),o(7,"div",4)(8,"h2"),c(9,"Update Product"),r(),o(10,"form",5),g("ngSubmit",function(){return n.onSubmit()}),o(11,"div",6)(12,"label",7),c(13,"Name"),r(),o(14,"div",8),m(15,"input",9),r()(),o(16,"div",6)(17,"label",10),c(18,"Price"),r(),o(19,"div",8),m(20,"input",11),r()(),o(21,"div",6)(22,"label",12),c(23,"Description"),r(),o(24,"div",8),m(25,"textarea",13),r()(),o(26,"div",6)(27,"label",14),c(28,"Category"),r(),o(29,"div",8)(30,"select",15),g("change",function(d){return n.onCategoryChanged(d)}),u(31,re,2,2,"option",16),r()()(),o(32,"div",6)(33,"label",17),c(34,"Images"),r(),o(35,"div",8)(36,"input",18),g("change",function(d){return n.onImageSelected(d)}),r()()(),u(37,ae,3,1,"div",19)(38,ce,3,1,"div",19),o(39,"div",20),u(40,de,2,1,"button",21)(41,le,4,0,"div",22),r()()()()()),e&2&&(s(10),a("formGroup",n.myForm),s(21),a("ngForOf",n.categories),s(6),a("ngIf",n.imagePreviews.length===0&&n.oldImages.length>0),s(),a("ngIf",n.imagePreviews.length>0),s(2),a("ngIf",!n.loading),s(),a("ngIf",n.loading))},dependencies:[T,Y,y,O,M,K,k,L,$,j,q,z,V,A,H,X,B,G],styles:[".btn-remove[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;border:none;font-size:12px;width:25px;height:25px;border-radius:20%;display:flex;align-items:center;justify-content:center;padding:0;transition:background-color .3s ease}.btn-remove[_ngcontent-%COMP%]:hover{background-color:#4caf50;color:#fff}[_ngcontent-%COMP%]::selection{background-color:#5c615c;color:#fff}"]})};var me=[{path:"",component:_}],S=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=b({type:i});static \u0275inj=h({imports:[F.forChild(me),F]})};var ee=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=b({type:i});static \u0275inj=h({imports:[y,S]})};export{ee as UpdateProductsModule};
