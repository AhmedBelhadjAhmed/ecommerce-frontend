import{a as H}from"./chunk-KACECMBE.js";import{a as D,b as y,c as P,d as T,f as O,h as G,i as U,o as q,q as A}from"./chunk-WMSCIBPS.js";import{a as R}from"./chunk-B5HR5V7T.js";import{a as j}from"./chunk-HGUX4EP4.js";import{a as k}from"./chunk-ZH3L7T54.js";import{k as M,l as N,o as p}from"./chunk-MLHW3EEE.js";import{$ as _,Ba as u,Ca as d,Oa as b,Ra as a,S as g,Ta as r,Ua as o,Va as h,Vb as L,Xa as I,Ya as E,Zb as S,aa as v,db as s,e as z,g as F,lb as w}from"./chunk-5XN3BUNB.js";var f=z(H());function J(e,n){e&1&&(r(0,"div",15),s(1," Valid email is required. "),o())}function K(e,n){e&1&&(r(0,"div",15),s(1," Password is required. "),o())}function Q(e,n){if(e&1&&(r(0,"button",16),s(1,"Login"),o()),e&2){let i=E();a("disabled",i.loginForm.invalid)}}function W(e,n){e&1&&(r(0,"div",17)(1,"div",18)(2,"span",19),s(3,"Loading..."),o()()())}var C=class e{constructor(n,i,t,l){this.fb=n;this.authService=i;this.usersService=t;this.router=l;this.loginForm=this.fb.group({email:["",[y.required,y.email]],password:["",[y.required]]})}loginForm;loading=!1;subscriptions=new F;onSubmit(){if(this.loginForm.invalid){f.default.fire("Error","Please fill all fields correctly","error");return}this.loading=!0;let n=this.loginForm.value,i=this.authService.loginUser(n).subscribe({next:t=>{if(t.token){this.authService.storeToken(t.token);let l=this.authService.extractIdFromToken();if(l){let m=this.usersService.getUserById(l).subscribe({next:c=>{localStorage.setItem("userEmail",c.email),localStorage.setItem("userRole",c.role),f.default.fire("Success","Login successful","success").then(()=>{this.loading=!1,c.role==="admin"?this.router.navigate(["/listCategories"]):c.role==="client"&&this.router.navigate(["/client"])})},error:c=>{this.loading=!1,console.error("Error fetching user:",c),f.default.fire("Error","Could not retrieve user information","error"),this.router.navigate(["/login"])}});this.subscriptions.add(m)}}},error:t=>{this.loading=!1,f.default.fire("Error",t.error?.error||"Login failed","error")}});this.subscriptions.add(i)}ngOnDestroy(){this.subscriptions.unsubscribe()}static \u0275fac=function(i){return new(i||e)(d(q),d(j),d(R),d(M))};static \u0275cmp=_({type:e,selectors:[["app-login"]],standalone:!0,features:[w],decls:22,vars:5,consts:[[1,"container","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","p-4",2,"width","400px"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3"],["for","email"],["id","email","formControlName","email","type","email","placeholder","Enter your email",1,"form-control"],["class","text-danger",4,"ngIf"],["for","password"],["id","password","formControlName","password","type","password","placeholder","Enter your password",1,"form-control"],[1,"d-grid"],["type","submit","class","btn btn-primary mb-3 custom-button",3,"disabled",4,"ngIf"],["class","d-flex justify-content-center align-items-center mb-3","style","height: 40px;",4,"ngIf"],[1,"text-center"],["routerLink","/forget",1,"text-muted"],[1,"text-danger"],["type","submit",1,"btn","btn-primary","mb-3","custom-button",3,"disabled"],[1,"d-flex","justify-content-center","align-items-center","mb-3",2,"height","40px"],["role","status",1,"spinner-border","text-success"],[1,"visually-hidden"]],template:function(i,t){if(i&1&&(h(0,"app-navbar"),r(1,"div",0)(2,"div",1)(3,"h2",2),s(4,"Login"),o(),r(5,"form",3),I("ngSubmit",function(){return t.onSubmit()}),r(6,"div",4)(7,"label",5),s(8,"Email"),o(),h(9,"input",6),b(10,J,2,0,"div",7),o(),r(11,"div",4)(12,"label",8),s(13,"Password"),o(),h(14,"input",9),b(15,K,2,0,"div",7),o(),r(16,"div",10),b(17,Q,2,1,"button",11)(18,W,4,0,"div",12),o(),r(19,"div",13)(20,"a",14),s(21,"Forgot my password?"),o()()()()()),i&2){let l,m;u(5),a("formGroup",t.loginForm),u(5),a("ngIf",((l=t.loginForm.get("email"))==null?null:l.invalid)&&((l=t.loginForm.get("email"))==null?null:l.touched)),u(5),a("ngIf",((m=t.loginForm.get("password"))==null?null:m.invalid)&&((m=t.loginForm.get("password"))==null?null:m.touched)),u(2),a("ngIf",!t.loading),u(),a("ngIf",t.loading)}},dependencies:[k,A,O,D,P,T,G,U,S,L,p,N],styles:[".custom-button[_ngcontent-%COMP%]{background-color:#0b9310}.custom-button[_ngcontent-%COMP%]:hover{background-color:#45a049}input[_ngcontent-%COMP%]::selection{background-color:#009024;color:#fff}[_ngcontent-%COMP%]::selection{background-color:#5c615c;color:#fff}"]})};var X=[{path:"",component:C}],x=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=v({type:e});static \u0275inj=g({imports:[p.forChild(X),p]})};var V=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=v({type:e});static \u0275inj=g({imports:[S,x]})};export{V as LoginModule};
