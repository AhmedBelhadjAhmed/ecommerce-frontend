import{a as W}from"./chunk-KACECMBE.js";import{a as D,b as P,c as G,d as q,f as B,h as L,i as z,o as X,q as Y}from"./chunk-WMSCIBPS.js";import{a as A}from"./chunk-B5HR5V7T.js";import{a as j}from"./chunk-HGUX4EP4.js";import{a as T}from"./chunk-ZH3L7T54.js";import{i as O,k as R,o as F}from"./chunk-MLHW3EEE.js";import{$ as E,Ba as l,Ca as p,Oa as x,Ra as c,S as b,Ta as o,Ua as r,Va as m,Vb as k,Wa as S,Xa as v,Ya as h,Za as N,Zb as C,aa as w,cb as M,db as a,e as Q,eb as V,ha as f,ia as g,lb as U,ya as I}from"./chunk-5XN3BUNB.js";var d=Q(W());function Z(n,i){if(n&1){let e=S();o(0,"div",23),m(1,"img",24),o(2,"button",25),v("click",function(){f(e);let s=h(),u=M(32);return g(s.removeImage(u))}),a(3,"X"),r()()}if(n&2){let e=h();l(),c("src",e.filePreview,I)}}function $(n,i){if(n&1&&(o(0,"button",26),a(1,"Update"),r()),n&2){let e=h();c("disabled",e.updateForm.invalid)}}function ee(n,i){n&1&&(o(0,"div",27)(1,"span",28),a(2,"Loading..."),r()())}var y=class n{constructor(i,e,t,s,u){this.fb=i;this.route=e;this.userService=t;this.authService=s;this.router=u;this.updateForm=this.fb.group({firstname:["",[P.required]],lastname:["",[P.required]],currentPassword:["",[P.required]],newPassword:["",[]],confirmPassword:["",[]],avatar:[null]},{validators:this.passwordMatchValidator})}updateForm;userId;selectedFile=null;filePreview=null;passwordVisible=!1;userEmail;loading=!1;ngOnInit(){this.userId=this.route.snapshot.paramMap.get("id"),this.userService.getUserById(this.userId).subscribe({next:i=>{this.updateForm.patchValue({firstname:i.firstname,lastname:i.lastname})},error:i=>{d.default.fire("Error","Failed to load user data","error")}})}togglePasswordVisibility(){this.passwordVisible=!this.passwordVisible}onFileSelected(i){let e=i.target.files[0];if(e){this.selectedFile=e;let t=new FileReader;t.onload=s=>{this.filePreview=s.target.result},t.readAsDataURL(e)}}removeImage(i){this.selectedFile=null,this.filePreview=null,this.updateForm.patchValue({avatar:null}),i&&(i.value="")}passwordMatchValidator(i){let e=i.get("newPassword")?.value,t=i.get("confirmPassword")?.value;return e===t?null:{mismatch:!0}}onSubmit(){if(this.loading=!0,this.updateForm.invalid){d.default.fire("Error","Please fill all required fields correctly","error");return}let i=this.updateForm.get("currentPassword")?.value;if(typeof localStorage<"u"&&(this.userEmail=localStorage.getItem("userEmail")),!this.userEmail){d.default.fire("Error","User email not found in local storage","error");return}this.authService.checkPassword({email:this.userEmail,password:i}).subscribe({next:e=>{if(!e.success){d.default.fire("Error","Incorrect current password","error");return}let t=new FormData;t.append("firstname",this.updateForm.get("firstname")?.value),t.append("lastname",this.updateForm.get("lastname")?.value),this.updateForm.get("newPassword")?.value&&t.append("password",this.updateForm.get("newPassword")?.value),this.selectedFile&&t.append("avatar",this.selectedFile),this.userService.updateUser(this.userId,t).subscribe({next:()=>{this.loading=!1,d.default.fire("Success","Profile updated successfully","success").then(()=>this.router.navigate(["/client"]))},error:s=>{this.loading=!1,d.default.fire("Error","Failed to update profile","error")}})},error:e=>{this.loading=!1,d.default.fire("Error","Error checking current password","error")}})}static \u0275fac=function(e){return new(e||n)(p(X),p(O),p(A),p(j),p(R))};static \u0275cmp=E({type:n,selectors:[["app-client-update"]],standalone:!0,features:[U],decls:37,vars:6,consts:[["fileInput",""],[1,"container","mt-5",2,"margin-top","70px"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First Name",1,"form-control"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last Name",1,"form-control"],["for","currentPassword",1,"form-label"],["type","password","id","currentPassword","formControlName","currentPassword","placeholder","Current Password",1,"form-control"],[1,"mb-3","position-relative"],["for","newPassword",1,"form-label"],["id","newPassword","formControlName","newPassword","placeholder","New Password",1,"form-control",2,"padding-right","3rem",3,"type"],["type","button",1,"btn","position-absolute",2,"top","70%","right","0.75rem","transform","translateY(-50%)","padding","0","border","none","background","transparent","display","flex","align-items","center","justify-content","center","cursor","pointer",3,"click"],[1,"material-icons"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm New Password",1,"form-control"],["for","avatar",1,"form-label"],["type","file","id","avatar","accept","image/*",1,"form-control",3,"change"],["class","image-preview-container mt-2 position-relative",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center"],["type","submit","class","btn btn-primary custom-button",3,"disabled",4,"ngIf"],["class","spinner-border text-success","role","status",4,"ngIf"],[1,"image-preview-container","mt-2","position-relative"],[1,"img-thumbnail",2,"width","150px","height","150px",3,"src"],["type","button",1,"btn","btn-danger","btn-sm","close-button",3,"click"],["type","submit",1,"btn","btn-primary","custom-button",3,"disabled"],["role","status",1,"spinner-border","text-success"],[1,"visually-hidden"]],template:function(e,t){if(e&1){let s=S();m(0,"app-navbar"),o(1,"div",1)(2,"h2"),a(3,"Update Profile"),r(),o(4,"form",2),v("ngSubmit",function(){return f(s),g(t.onSubmit())}),o(5,"div",3)(6,"label",4),a(7,"First Name"),r(),m(8,"input",5),r(),o(9,"div",3)(10,"label",6),a(11,"Last Name"),r(),m(12,"input",7),r(),o(13,"div",3)(14,"label",8),a(15,"Current Password"),r(),m(16,"input",9),r(),o(17,"div",10)(18,"label",11),a(19,"New Password"),r(),m(20,"input",12),o(21,"button",13),v("click",function(){return f(s),g(t.togglePasswordVisibility())}),o(22,"span",14),a(23),r()()(),o(24,"div",3)(25,"label",15),a(26,"Confirm New Password"),r(),m(27,"input",16),r(),o(28,"div",3)(29,"label",17),a(30,"Avatar"),r(),o(31,"input",18,0),v("change",function(K){return f(s),g(t.onFileSelected(K))}),r(),x(33,Z,4,1,"div",19),r(),o(34,"div",20),x(35,$,2,1,"button",21)(36,ee,3,0,"div",22),r()()()}e&2&&(l(4),c("formGroup",t.updateForm),l(16),N("type",t.passwordVisible?"text":"password"),l(3),V(t.passwordVisible?"visibility_off":"visibility"),l(10),c("ngIf",t.filePreview),l(2),c("ngIf",!t.loading),l(),c("ngIf",t.loading))},dependencies:[T,Y,B,D,G,q,L,z,C,k],styles:[".container[_ngcontent-%COMP%]{max-width:600px}img[_ngcontent-%COMP%]{margin-top:10px;margin-right:10px;display:block}button.btn-danger[_ngcontent-%COMP%]{display:block;margin-top:10px}.image-preview-container[_ngcontent-%COMP%]{display:inline-block;position:relative}.close-button[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;z-index:10}.custom-button[_ngcontent-%COMP%]{background-color:#0b9310}.custom-button[_ngcontent-%COMP%]:hover{background-color:#45a049}input[_ngcontent-%COMP%]::selection{background-color:#009024;color:#fff}.container[_ngcontent-%COMP%]{padding-top:70px}[_ngcontent-%COMP%]::selection{background-color:#5c615c;color:#fff}"]})};var te=[{path:"",component:y}],_=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=w({type:n});static \u0275inj=b({imports:[F.forChild(te),F]})};var J=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=w({type:n});static \u0275inj=b({imports:[C,_]})};export{J as ClientUpdateModule};
